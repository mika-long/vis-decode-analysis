library(tidyverse)
library(ggplot2)
library(sgt)
library(numDeriv)
df <- read.csv("vis-decode-slider_all_tidy.csv") %>% as_tibble(.)
df %>% count(participantId)
df %>% count(participantId) %>% filter(n == 492)
df %>% count(participantId) %>% filter(n == 492) %>% pull(participantId)
df %>% count(participantId) %>% filter(n == 492) %>% pull(participantId) -> ids
ids
df %>% filter(participantId %in% ids)
df %>% filter(participantId %in% ids) %>%
filter(grepl("task", trialId) & grepl("test", trialId) ) # %>%
df %>% filter(participantId %in% ids) %>%
filter(grepl("task", trialId) & grepl("test", trialId) ) %>%
select(participantId, trialId, responseId, answer) %>%
mutate(answer = as.numeric(answer)) # %>%
df %>% filter(participantId %in% ids) %>%
filter(grepl("task", trialId) & grepl("test", trialId) ) %>%
select(participantId, trialId, responseId, answer) %>%
mutate(answer = as.numeric(answer)) %>%
pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") # %>%
df %>% filter(participantId %in% ids) %>%
filter(grepl("task", trialId) & grepl("test", trialId) ) %>%
select(participantId, trialId, responseId, answer) %>%
mutate(answer = as.numeric(answer)) %>%
pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") -> task_df # %>%
# separate_wider_delim(trialId, delim="_", names = c("TaskType", "type", "id")) %>%
# select(-type, -pixel.x, -pixel.y) -> task_df
task_df
task_df
task_df %>% filter(grepl("task1", trialId))
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(median.x = qsgt(0.5, param.mu, param.sigma, param.lambda, param.p, param.q),
median.y = dsgt(median.x, param.mu, param.sigma, param.lambda, param.p, param.q)) %>%
select(participantId, TaskType, id, location.x, location.y, median.x, median.y)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(median.x = qsgt(0.5, param.mu, param.sigma, param.lambda, param.p, param.q),
median.y = dsgt(median.x, param.mu, param.sigma, param.lambda, param.p, param.q)) %>%
select(participantId, location.x, location.y, median.x, median.y)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q))
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point() +
theme_minimal()
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.8) +
theme_minimal()
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.8) +
theme_minimal() + ylim(-1, 1)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.8) +
theme_minimal() + xlim(-1, 1)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.8) +
theme_minimal() + xlim(-1, 1) + ylim(0, 1)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.5) +
theme_minimal() + xlim(-1, 1) + ylim(0, 1)
task_df %>% filter(grepl("task2", trialId)) # %>%
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu)
?dsgy
?dsgt
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q, mean.cent=F)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.5) +
theme_minimal() + xlim(-1, 1) + ylim(0, 1)
task_df %>% filter(grepl("task1", trialId)) %>%
mutate(left_area = psgt(location.x, param.mu, param.sigma,
param.lambda, param.p, param.q, mean.cent=F)) %>%
select(param.lambda, left_area) %>%
ggplot(aes(x = param.lambda, y = left_area)) +
geom_point(alpha = 0.5) +
theme_minimal() + xlim(-1, 1) + ylim(0, 1) +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray")
task_df %>% filter(TaskType == "task2") %>%
mutate(answer.x = param.mu,
answer.y = dsgt(answer.x, param.mu, param.sigma, param.lambda, param.p, param.q, mean.cent=F)) %>%
select(location.x, location.y, answer.x, answer.y)
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu,
answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma,
lambda=param.lambda, p=param.p, q=param.q, mean.cent = F))
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu,
answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma,
lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>%
select(participantId, location.x, location.y, answer.x, answer.y)
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu,
answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma,
lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>%
select(participantId, location.x, location.y, answer.x, answer.y) %>%
mutate(x_diff = location.x - answer.x)
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu,
answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma,
lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>%
select(participantId, location.x, location.y, answer.x, answer.y) %>%
mutate(x_diff = location.x - answer.x) %>%
ggplot(aes(x = x_diff)) + geom_density() + theme_minimal()
task_df %>% filter(grepl("task2", trialId)) %>%
mutate(answer.x = param.mu,
answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma,
lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>%
select(participantId, location.x, location.y, answer.x, answer.y) %>%
mutate(y_diff = location.y - answer.y) %>%
ggplot(aes(x = y_diff)) + geom_density() + theme_minimal()
task_df %>% filter(grepl("task3", trialId))
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = location.y, color=participantId)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray")
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray")
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray") +
facet_grid(~particpantId)
task_df %>% filter(grepl("task3", trialId)) # %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray") +
facet_grid(~particpantId)
task_df %>% filter(grepl("task3", trialId)) # %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray") +
facet_wrap(~ participantId)
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray") +
facet_wrap(~ participantId)
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = location.y)) +
geom_point() +
theme_minimal() +
geom_hline(yintercept = 0.5, linetype="dashed", color="gray") # +
# facet_wrap(~ participantId)
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = param.mu)) +
geom_point() + theme_minimal() +
geom_abline(slope = 1, intercept = 0, linetype="dashed", color="gray") +
coord_equal()
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = param.mu)) +
geom_point(alpha=0.8) + theme_minimal() +
geom_abline(slope = 1, intercept = 0, linetype="dashed", color="gray") +
coord_equal()
task_df %>% filter(grepl("task3", trialId)) %>%
ggplot(aes(x = location.x, y = param.mu)) +
geom_point(alpha=0.5) + theme_minimal() +
geom_abline(slope = 1, intercept = 0, linetype="dashed", color="gray") +
coord_equal()
df %>% filter(grepl("task5", trialId)) %>%
filter(grepl("test", trialId)) %>%
select(participantId, trialId, responseId, answer) %>%
mutate(answer = as.numeric(answer)) %>%
pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") %>%
separate_wider_delim(trialId, delim="_", names = c("TaskType", "type", "id")) %>%
select(-type) -> task_5
task_5
task_5 %>%
ggplot(aes(x = slider.x, y = location.x)) +
geom_point() +
theme_minimal() +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed") +
coord_equal()
task_5 %>%
ggplot(aes(x = slider.x, y = location.x)) +
geom_point(alpha=0.5) +
theme_minimal() +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed") +
coord_equal()
task_5 %>%
ggplot(aes(x = slider.y, y = location.y)) +
geom_point(alpha=0.5) +
theme_minimal() +
geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed") +
coord_equal()
#| echo: false
#| output: false
#| label: setup
library(tidyverse)
library(ggplot2)
# setting the theme
theme_set(theme_minimal())
# model
library(brms)
# plot results
library(tidybayes)
library(rstan)
#| label: read-in-data
#| code-fold: true
df <- read.csv("vis-decode-slider_all_tidy.csv") %>% as_tibble(.)
# filter
ids <- df %>% count(participantId) %>% filter(n == 492) %>% pull(participantId)
df <- df %>% filter(participantId %in% ids)
# create a separate dataframe for just test related trials
task_df <- df %>% filter(grepl("task", trialId) & grepl("test", trialId) ) %>%
select(participantId, trialId, responseId, answer) %>%
mutate(answer = as.numeric(answer)) %>%
pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") %>%
separate_wider_delim(trialId, delim = "_", names = c("task", "type", "id")) %>%
select(-type) %>%
rename(data.select.x = location.x,
data.select.y = location.y,
pixel.select.x = pixel.x,
pixel.select.y = pixel.y)
#| label: define-function
#| code-fold: true
# origin is top left
data_to_pixel_y <- function(data_y) {
return(-395 * data_y + 410)
}
data_to_pixel_x <- function(data_x) {
return (53.5 * data_x + 317.5)
}
# origin is bottom left
pixel_to_phy_x <- function(pixel, pxMM){
(pixel - 50) / pxMM
}
pixel_to_phy_y <- function(pixel, pxMM){
(410 - pixel) / pxMM
}
# return visual angle in degrees and not radian
vis_angle <- function(size, distance){
return(2 * atan(size / (2 * distance)) * 180 / pi)
}
# tolerance for numerical precision
tolerance <- 1e-10
#| label: define-special-dfs
#| code-fold: true
p <- df %>% filter(participantId %in% ids) %>%
filter(grepl("pixelsPerMM", responseId) | grepl("prolificId", responseId)) %>%
select(participantId, responseId, answer) %>%
pivot_wider(names_from = responseId, values_from = answer) %>%
pull(participantId)
# custom dataframe
pixel_to_mm <- data.frame(participantId = p,
pixelToMM = c(3.73, 3.27, 3.27, 5.03, 3.73, 3.25, 3.73, 3.27, 3.73, 3.27, 5.14, 3.30, 3.29)
)
vis_distance <- data.frame(participantId = p,
dist_to_screen = c(426, 502, 500, 495, 485, 987, 635, 500, 479, 563, 449, 685, 462))
# combine
participants <- pixel_to_mm %>% left_join(vis_distance, by = join_by(participantId))
#| label: get task 1 data
#| code-fold: true
task1_df <- task_df %>% filter(task == "task1") %>%
select(-slider.x, -slider.y) %>%
mutate(data.select.left_area = psgt(data.select.x, param.mu, param.sigma, param.lambda, param.p, param.q, mean.cent = FALSE),
data.ans.x = qsgt(0.5, param.mu, param.sigma, param.lambda, param.p, param.q, mean.cent = FALSE)) %>%
left_join(participants, by = join_by(participantId))
library(sgt)
#| label: get task 1 data
#| code-fold: true
task1_df <- task_df %>% filter(task == "task1") %>%
select(-slider.x, -slider.y) %>%
mutate(data.select.left_area = psgt(data.select.x, param.mu, param.sigma, param.lambda, param.p, param.q, mean.cent = FALSE),
data.ans.x = qsgt(0.5, param.mu, param.sigma, param.lambda, param.p, param.q, mean.cent = FALSE)) %>%
left_join(participants, by = join_by(participantId))
task1_df
task1_df
mix <- brms::mixture(gaussian, gaussian)
formula <- bf(data.select.x ~ 1)
# get prior
get_prior(formula = formula, data = task1_df, family = mix)
task1_edf
task1_df
formula <- bf(data.select.x ~ 0 + data.select.x:mu1 + param.mu:mu2,
mu1 ~ 0,
mu2 ~ 0
)
mix <- brms::mixture(gaussian, gaussian)
formula <- bf(data.select.x ~ 0 + data.select.x:mu1 + param.mu:mu2,
mu1 ~ 0,
mu2 ~ 0
)
# get prior
get_prior(formula = formula, data = task1_df, family = mix)
formula <- bf(data.select.x ~ 0 + data.select.x:mu1 + param.mu:mu2,
mu1 ~ 0,
mu2 ~ 0,
sigma1 ~ 0 + (1 | participantId),
sigma2 ~ 0 + (1 | participantId)
)
# get prior
get_prior(formula = formula, data = task1_df, family = mix)
mix <- brms::mixture(gaussian, gaussian)
formula <- bf(data.select.x ~ 0 + data.select.x:mu1 + param.mu:mu2,
mu1 ~ 0,
mu2 ~ 0,
sigma1 ~ 0 + (1 | participantId),
sigma2 ~ 0 + (1 | participantId)
)
# get prior
get_prior(formula = formula, data = task1_df, family = mix)
#| output: false
mixture_model <- brm(
formula = formula,
data = task1_df,
family = mix,
prior = prior,
chains = 4,
cores = 4,
iter = 10000,
warmup = 5000,
file = "models/task1"
)
#| output: false
mixture_model <- brm(
formula = formula,
data = task1_df,
family = mix,
# prior = prior,
chains = 4,
cores = 4,
iter = 10000,
warmup = 5000,
file = "models/task1"
)
mix <- brms::mixture(gaussian, gaussian, order = "none")
formula <- bf(data.select.x ~ 0 + data.select.x:mu1 + param.mu:mu2,
mu1 ~ 0,
mu2 ~ 0,
sigma1 ~ 0 + (1 | participantId),
sigma2 ~ 0 + (1 | participantId)
)
# get prior
get_prior(formula = formula, data = task1_df, family = mix)
#| output: false
mixture_model <- brm(
formula = formula,
data = task1_df,
family = mix,
# prior = prior,
chains = 4,
cores = 4,
iter = 10000,
warmup = 5000,
file = "models/task1"
)
pair(mixture_model)
pairs(mixture_model)
summary(mixture_model)
#| output: false
mixture_model <- brm(
formula = formula,
data = task1_df,
family = mix,
# prior = prior,
chains = 4,
cores = 4,
iter = 10000,
warmup = 5000,
file = "models/task1",
adapt_delta = 0.99
)
#| output: false
mixture_model <- brm(
formula = formula,
data = task1_df,
family = mix,
# prior = prior,
chains = 4,
cores = 4,
iter = 10000,
warmup = 5000,
file = "models/task1",
control = list(adapt_delta = 0.95),
)
pairs(mixture_model)
summary(mixture_model)
make_stancode(formula = formula,
data = task1_df,
family = mix)
install.packages("brms")
install.packages("brms")
install.packages("brms")
install.packages("brms")
install.packages("brms")
install.packages("brms")
