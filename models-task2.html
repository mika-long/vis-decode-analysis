<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Models Task 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="models-task2_files/libs/clipboard/clipboard.min.js"></script>
<script src="models-task2_files/libs/quarto-html/quarto.js"></script>
<script src="models-task2_files/libs/quarto-html/popper.min.js"></script>
<script src="models-task2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="models-task2_files/libs/quarto-html/anchor.min.js"></script>
<link href="models-task2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="models-task2_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="models-task2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="models-task2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="models-task2_files/libs/bootstrap/bootstrap-4f863c1579693c9d56bbaaf04c81ce69.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="models-task2_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="models-task2_files/libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#set-up" id="toc-set-up" class="nav-link active" data-scroll-target="#set-up">Set up</a></li>
  <li><a href="#task-2-find-highest-point-on-curve" id="toc-task-2-find-highest-point-on-curve" class="nav-link" data-scroll-target="#task-2-find-highest-point-on-curve">Task 2 – Find highest point on curve</a>
  <ul class="collapse">
  <li><a href="#model-1-vis-angle-space" id="toc-model-1-vis-angle-space" class="nav-link" data-scroll-target="#model-1-vis-angle-space">Model 1 – Vis Angle space</a>
  <ul class="collapse">
  <li><a href="#model-1.1-laplace-distribution" id="toc-model-1.1-laplace-distribution" class="nav-link" data-scroll-target="#model-1.1-laplace-distribution">Model 1.1 — Laplace distribution</a></li>
  <li><a href="#model-2.3-cauchy" id="toc-model-2.3-cauchy" class="nav-link" data-scroll-target="#model-2.3-cauchy">Model 2.3 — Cauchy</a></li>
  <li><a href="#model-2.2-normal" id="toc-model-2.2-normal" class="nav-link" data-scroll-target="#model-2.2-normal">Model 2.2 — Normal</a></li>
  <li><a href="#loo-comparisons" id="toc-loo-comparisons" class="nav-link" data-scroll-target="#loo-comparisons">LOO comparisons</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Models Task 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="set-up" class="level1">
<h1>Set up</h1>
<p>read in data and write functions for processing:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"vis-decode-slider_all_tidy.csv"</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(.)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># filter </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">count</span>(participantId) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(n <span class="sc">==</span> <span class="dv">492</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(participantId) </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(participantId <span class="sc">%in%</span> ids)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create a separate dataframe for just test related trials </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>task_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"task"</span>, trialId) <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"test"</span>, trialId) ) <span class="sc">%&gt;%</span> </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(participantId, trialId, responseId, answer) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">answer =</span> <span class="fu">as.numeric</span>(answer)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> responseId, <span class="at">values_from =</span> answer, <span class="at">names_repair =</span> <span class="st">"universal"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_wider_delim</span>(trialId, <span class="at">delim =</span> <span class="st">"_"</span>, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"task"</span>, <span class="st">"type"</span>, <span class="st">"id"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>type) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">data.select.x =</span> location.x, </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">data.select.y =</span> location.y,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">pixel.select.x =</span> pixel.x, </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">pixel.select.y =</span> pixel.y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `location-x` -&gt; `location.x`
• `location-y` -&gt; `location.y`
• `pixel-x` -&gt; `pixel.x`
• `pixel-y` -&gt; `pixel.y`
• `param-mu` -&gt; `param.mu`
• `param-sigma` -&gt; `param.sigma`
• `param-lambda` -&gt; `param.lambda`
• `param-p` -&gt; `param.p`
• `param-q` -&gt; `param.q`
• `slider-x` -&gt; `slider.x`
• `slider-y` -&gt; `slider.y`</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># origin is top left  </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data_to_pixel_y <span class="ot">&lt;-</span> <span class="cf">function</span>(data_y) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span><span class="dv">395</span> <span class="sc">*</span> data_y <span class="sc">+</span> <span class="dv">410</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>data_to_pixel_x <span class="ot">&lt;-</span> <span class="cf">function</span>(data_x) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span> (<span class="fl">53.5</span> <span class="sc">*</span> data_x <span class="sc">+</span> <span class="fl">317.5</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># origin is bottom left </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>pixel_to_phy_x <span class="ot">&lt;-</span> <span class="cf">function</span>(pixel, pxMM){</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  (pixel <span class="sc">-</span> <span class="dv">50</span>) <span class="sc">/</span> pxMM</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>pixel_to_phy_y <span class="ot">&lt;-</span> <span class="cf">function</span>(pixel, pxMM){</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  (<span class="dv">410</span> <span class="sc">-</span> pixel) <span class="sc">/</span> pxMM</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># return visual angle in degrees and not radian</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>vis_angle <span class="ot">&lt;-</span> <span class="cf">function</span>(size, distance){</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="dv">2</span> <span class="sc">*</span> <span class="fu">atan</span>(size <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> distance)) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># tolerance for numerical precision </span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>tolerance <span class="ot">&lt;-</span> <span class="fl">1e-10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(participantId <span class="sc">%in%</span> ids) <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"pixelsPerMM"</span>, responseId) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">"prolificId"</span>, responseId)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(participantId, responseId, answer) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> responseId, <span class="at">values_from =</span> answer) <span class="sc">%&gt;%</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(participantId)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># custom dataframe </span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>pixel_to_mm <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">participantId =</span> p, </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pixelToMM =</span> <span class="fu">c</span>(<span class="fl">3.73</span>, <span class="fl">3.27</span>, <span class="fl">3.27</span>, <span class="fl">5.03</span>, <span class="fl">3.73</span>, <span class="fl">3.25</span>, <span class="fl">3.73</span>, <span class="fl">3.27</span>, <span class="fl">3.73</span>, <span class="fl">3.27</span>, <span class="fl">5.14</span>, <span class="fl">3.30</span>, <span class="fl">3.29</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>vis_distance <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">participantId =</span> p, </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">dist_to_screen =</span> <span class="fu">c</span>(<span class="dv">426</span>, <span class="dv">502</span>, <span class="dv">500</span>, <span class="dv">495</span>, <span class="dv">485</span>, <span class="dv">987</span>, <span class="dv">635</span>, <span class="dv">500</span>, <span class="dv">479</span>, <span class="dv">563</span>, <span class="dv">449</span>, <span class="dv">685</span>, <span class="dv">462</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combine </span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>participants <span class="ot">&lt;-</span> pixel_to_mm <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(vis_distance, <span class="at">by =</span> <span class="fu">join_by</span>(participantId))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task-2-find-highest-point-on-curve" class="level1 page-columns page-full">
<h1>Task 2 – Find highest point on curve</h1>
<p>First we get the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>task2_df <span class="ot">&lt;-</span> task_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(task <span class="sc">==</span> <span class="st">"task2"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>slider.x, <span class="sc">-</span>slider.y) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data.ans.x =</span> param.mu, </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">data.ans.y =</span> <span class="fu">dsgt</span>(param.mu, param.mu, param.sigma, param.lambda, param.p, param.q, <span class="at">mean.cent =</span> <span class="cn">FALSE</span>),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">data.select.grad =</span> numDeriv<span class="sc">::</span><span class="fu">grad</span>(dsgt, data.select.x, <span class="at">mu =</span> param.mu, <span class="at">sigma =</span> param.sigma, <span class="at">lambda =</span> param.lambda, <span class="at">p =</span> param.p, <span class="at">q =</span> param.q, <span class="at">mean.cent =</span> <span class="cn">FALSE</span>), </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">data.select.angle =</span> <span class="fu">atan</span>(data.select.grad) <span class="sc">*</span> <span class="dv">180</span> <span class="sc">/</span> pi) <span class="sc">%&gt;%</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(participants, <span class="at">by =</span> <span class="fu">join_by</span>(participantId)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate things related to participants' selection </span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">phy.select.x =</span> <span class="fu">pixel_to_phy_x</span>(pixel.select.x, pixelToMM), </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">phy.select.y =</span> <span class="fu">pixel_to_phy_y</span>(pixel.select.y, pixelToMM),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">va.select.x =</span> <span class="fu">vis_angle</span>(phy.select.x, dist_to_screen), </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">va.select.y =</span> <span class="fu">vis_angle</span>(phy.select.y, dist_to_screen)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate things related to answer </span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pixel.ans.x =</span> <span class="fu">data_to_pixel_x</span>(data.ans.x), </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">pixel.ans.y =</span> <span class="fu">data_to_pixel_y</span>(data.ans.y), </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">phy.ans.x =</span> <span class="fu">pixel_to_phy_x</span>(pixel.ans.x, pixelToMM), </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">phy.ans.y =</span> <span class="fu">pixel_to_phy_y</span>(pixel.ans.y, pixelToMM),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">va.ans.x =</span> <span class="fu">vis_angle</span>(phy.ans.x, dist_to_screen),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">va.ans.y =</span> <span class="fu">vis_angle</span>(phy.ans.y, dist_to_screen))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some preliminary checks of relations, focusing on the <strong>y</strong> axes:</p>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> phy.ans.y <span class="sc">-</span> phy.select.y, <span class="at">x =</span> dist_to_screen)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> va.ans.y <span class="sc">-</span> va.select.y, <span class="at">x =</span> dist_to_screen)) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> va.ans.y <span class="sc">-</span> va.select.y)) <span class="sc">+</span> <span class="fu">geom_dots</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> phy.ans.y <span class="sc">-</span> phy.select.y)) <span class="sc">+</span> <span class="fu">geom_dots</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-1-4.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>Now let’s look at things focusing on the <strong>x</strong> axes:</p>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> data.ans.x <span class="sc">-</span> data.select.x)) <span class="sc">+</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dots</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> va.ans.x <span class="sc">-</span> va.select.x)) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dots</span>()</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> va.ans.x <span class="sc">-</span> va.select.x)) <span class="sc">+</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dots</span>() <span class="sc">+</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>participantId)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> va.ans.x <span class="sc">-</span> va.select.x, <span class="at">x =</span> dist_to_screen)) <span class="sc">+</span> </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> va.select.x <span class="sc">-</span> va.ans.x, <span class="at">x =</span> param.lambda)) <span class="sc">+</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Signed error on x-axes against skewness"</span>)</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> va.select.x <span class="sc">-</span> va.ans.x, <span class="at">x =</span> param.p, <span class="at">color =</span> param.lambda)) <span class="sc">+</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Signed error on x-axes against flat-top-ness"</span>) <span class="sc">+</span> </span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient2</span>(</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">"RdYlBu"</span>)[<span class="dv">1</span>],   <span class="co"># Red for negative</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">"RdYlBu"</span>)[<span class="dv">6</span>],   <span class="co"># Yellow for zero</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="fu">brewer.pal</span>(<span class="dv">11</span>, <span class="st">"RdYlBu"</span>)[<span class="dv">11</span>], <span class="co"># Blue for positive</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-5.png" class="img-fluid" width="672"></p>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="models-task2_files/figure-html/unnamed-chunk-2-6.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<section id="model-1-vis-angle-space" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="model-1-vis-angle-space">Model 1 – Vis Angle space</h2>
<p>Let us first try to fit <code>va.ans.x - va.select.x</code> with two different models — normal and laplace.</p>
<section id="model-1.1-laplace-distribution" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="model-1.1-laplace-distribution">Model 1.1 — Laplace distribution</h3>
<p>$$ <span class="math display">\[\begin{align*}
\text{error_va}_{i} &amp;\sim \text{Laplace}(\mu_{\text{PID}[i]}, b_{\text{PID}[i]}) \\
\mu_j &amp;= \alpha_\mu + \mathcal{N}(0, \sigma_\mu^2), j \in [13] \\
b_j &amp;= \alpha_b + \mathcal{N}(0, \sigma_b^2), j \in [13] \\

\end{align*}\]</span> $$</p>
<p>Specify formula. There is no native implementation of the Laplace distribution<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>:</p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;except for the <a href="https://paulbuerkner.com/brms/reference/AsymLaplace.html"><code>asym_laplace</code> function</a>, which doesn’t seem to help. Maybe we’ll need to implement a custom function using <code>stan</code> … </p></div></div><div class="callout callout-style-default callout-note callout-titled" data-collapsed="true">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is a <a href="https://en.wikipedia.org/wiki/Laplace_distribution">wiki</a> about Laplace distribution, which defines the pdf of a Laplace distribution to be <span class="math inline">\(f(x | \mu, b) = \frac{1}{2b} \exp(-\frac{|x - \mu|}{b})\)</span>, where <span class="math inline">\(\mu\)</span> is a location parameter, and <span class="math inline">\(b &gt; 0\)</span> is a scale parameter. And this is what the <a href="https://en.wikipedia.org/wiki/Laplace_distribution">stan manual</a> defines the pdf of the <strong>double exponential</strong> distribution — <span class="math inline">\(f(y|\mu, \sigma) = \frac{1}{2\sigma} \exp(- \frac{|y - \mu|}{\sigma})\)</span>, basically everything is the same except they’re using different notations for the scale parameter …</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log of the laplace pdf </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>laplace_lpdf <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">real laplace_lpdf(real y, real mu, real sigma) {</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">  return -log(2 * sigma) - abs(y - mu) / sigma;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># define custom family </span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>c_family <span class="ot">=</span> <span class="fu">custom_family</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"laplace"</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpars =</span> <span class="fu">c</span>(<span class="st">"mu"</span>, <span class="st">"sigma"</span>), </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="fu">c</span>(<span class="st">"identity"</span>, <span class="st">"log"</span>), </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">lb =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">0</span>), </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"real"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">bf</span>(error_va <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId), </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> c_family)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co"># get prior</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.select.x <span class="sc">-</span> va.ans.x) <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">formula =</span> f,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["prior"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["coef"],"name":[3],"type":["chr"],"align":["left"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]},{"label":["resp"],"name":[5],"type":["chr"],"align":["left"]},{"label":["dpar"],"name":[6],"type":["chr"],"align":["left"]},{"label":["nlpar"],"name":[7],"type":["chr"],"align":["left"]},{"label":["lb"],"name":[8],"type":["chr"],"align":["left"]},{"label":["ub"],"name":[9],"type":["chr"],"align":["left"]},{"label":["source"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"sigma","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define prior </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">dpar=</span><span class="st">"mu"</span>), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">dpar=</span><span class="st">"sigma"</span>), </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">group =</span> <span class="st">"participantId"</span>, <span class="at">dpar=</span><span class="st">"mu"</span>, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">group =</span> <span class="st">"participantId"</span>, <span class="at">dpar=</span><span class="st">"sigma"</span>, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" data-collapsed="true">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>What if we use the <code>make_stancode</code> function to see what the corresponding stan code looks like?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.ans.x <span class="sc">-</span> va.select.x) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">make_stancode</span>(f, <span class="at">data =</span> ., <span class="at">family =</span> c_family, <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> laplace_lpdf, <span class="at">block =</span> <span class="st">"functions"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>// generated with brms 2.22.0
functions {
  
real laplace_lpdf(real y, real mu, real sigma) {
  return -log(2 * sigma) - abs(y - mu) / sigma;
}

}
data {
  int&lt;lower=1&gt; N;  // total number of observations
  vector[N] Y;  // response variable
  // data for group-level effects of ID 1
  int&lt;lower=1&gt; N_1;  // number of grouping levels
  int&lt;lower=1&gt; M_1;  // number of coefficients per level
  array[N] int&lt;lower=1&gt; J_1;  // grouping indicator per observation
  // group-level predictor values
  vector[N] Z_1_1;
  // data for group-level effects of ID 2
  int&lt;lower=1&gt; N_2;  // number of grouping levels
  int&lt;lower=1&gt; M_2;  // number of coefficients per level
  array[N] int&lt;lower=1&gt; J_2;  // grouping indicator per observation
  // group-level predictor values
  vector[N] Z_2_sigma_1;
  int prior_only;  // should the likelihood be ignored?
}
transformed data {
}
parameters {
  real Intercept;  // temporary intercept for centered predictors
  real Intercept_sigma;  // temporary intercept for centered predictors
  vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations
  array[M_1] vector[N_1] z_1;  // standardized group-level effects
  vector&lt;lower=0&gt;[M_2] sd_2;  // group-level standard deviations
  array[M_2] vector[N_2] z_2;  // standardized group-level effects
}
transformed parameters {
  vector[N_1] r_1_1;  // actual group-level effects
  vector[N_2] r_2_sigma_1;  // actual group-level effects
  real lprior = 0;  // prior contributions to the log posterior
  r_1_1 = (sd_1[1] * (z_1[1]));
  r_2_sigma_1 = (sd_2[1] * (z_2[1]));
  lprior += student_t_lpdf(Intercept | 3, 0, 2.5);
  lprior += student_t_lpdf(Intercept_sigma | 3, 0, 2.5);
  lprior += student_t_lpdf(sd_1 | 3, 0, 2.5)
    - 1 * student_t_lccdf(0 | 3, 0, 2.5);
  lprior += student_t_lpdf(sd_2 | 3, 0, 2.5)
    - 1 * student_t_lccdf(0 | 3, 0, 2.5);
}
model {
  // likelihood including constants
  if (!prior_only) {
    // initialize linear predictor term
    vector[N] mu = rep_vector(0.0, N);
    // initialize linear predictor term
    vector[N] sigma = rep_vector(0.0, N);
    mu += Intercept;
    sigma += Intercept_sigma;
    for (n in 1:N) {
      // add more terms to the linear predictor
      mu[n] += r_1_1[J_1[n]] * Z_1_1[n];
    }
    for (n in 1:N) {
      // add more terms to the linear predictor
      sigma[n] += r_2_sigma_1[J_2[n]] * Z_2_sigma_1[n];
    }
    sigma = exp(sigma);
    for (n in 1:N) {
      target += laplace_lpdf(Y[n] | mu[n], sigma[n]);
    }
  }
  // priors including constants
  target += lprior;
  target += std_normal_lpdf(z_1[1]);
  target += std_normal_lpdf(z_2[1]);
}
generated quantities {
  // actual population-level intercept
  real b_Intercept = Intercept;
  // actual population-level intercept
  real b_sigma_Intercept = Intercept_sigma;
}</code></pre>
</div>
</div>
</div>
</div>
<p>Fit the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>m1<span class="fl">.1</span> <span class="ot">&lt;-</span> task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.ans.x <span class="sc">-</span> va.select.x) <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> f, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> c_family, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> laplace_lpdf, <span class="at">block =</span> <span class="st">"functions"</span>), </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> p, </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ., </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cores = 4, </span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># control = list(adapt_delta = 0.95), </span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"models/task2-m1.1"</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the fitted model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: laplace 
  Links: mu = identity; sigma = log 
Formula: error_va ~ 1 + (1 | participantId) 
         sigma ~ 1 + (1 | participantId)
   Data: . (Number of observations: 130) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~participantId (Number of levels: 13) 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)           0.03      0.02     0.00     0.08 1.00     1112     1591
sd(sigma_Intercept)     0.17      0.12     0.01     0.44 1.00     1319     1060

Regression Coefficients:
                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept           0.01      0.02    -0.02     0.04 1.00     2348     2157
sigma_Intercept    -1.79      0.10    -1.99    -1.58 1.00     2687     2264

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(m1<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                            Estimate
b_Intercept                                                              0.009290107
b_sigma_Intercept                                                       -1.785955202
sd_participantId__Intercept                                              0.026241116
sd_participantId__sigma_Intercept                                        0.173495770
Intercept                                                                0.009290107
Intercept_sigma                                                         -1.785955202
r_participantId[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]         -0.004558380
r_participantId[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]         -0.008206242
r_participantId[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]          0.005313247
r_participantId[51da084f-6438-4f40-9569-443698b4437e,Intercept]         -0.012594194
r_participantId[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]         -0.019552853
r_participantId[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]          0.018101979
r_participantId[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]         -0.003030238
r_participantId[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]          0.018660999
r_participantId[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]         -0.011051492
r_participantId[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]         -0.002754483
r_participantId[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]          0.014047583
r_participantId[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]         -0.001965746
r_participantId[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]          0.007297870
r_participantId__sigma[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]  -0.075485412
r_participantId__sigma[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]  -0.027974376
r_participantId__sigma[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]  -0.013155971
r_participantId__sigma[51da084f-6438-4f40-9569-443698b4437e,Intercept]   0.032576615
r_participantId__sigma[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]   0.142228013
r_participantId__sigma[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]  -0.039856994
r_participantId__sigma[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]  -0.072093084
r_participantId__sigma[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]   0.148023350
r_participantId__sigma[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]  -0.036963860
r_participantId__sigma[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]  -0.092961626
r_participantId__sigma[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]   0.084710846
r_participantId__sigma[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]  -0.054689067
r_participantId__sigma[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]  -0.050539962
lprior                                                                  -0.448682002
lp__                                                                   -28.988063812
                                                                        Est.Error
b_Intercept                                                            0.01574627
b_sigma_Intercept                                                      0.10329566
sd_participantId__Intercept                                            0.02068218
sd_participantId__sigma_Intercept                                      0.11927741
Intercept                                                              0.01574627
Intercept_sigma                                                        0.10329566
r_participantId[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]        0.02496066
r_participantId[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]        0.02712685
r_participantId[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]        0.02483099
r_participantId[51da084f-6438-4f40-9569-443698b4437e,Intercept]        0.02481450
r_participantId[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]        0.03214020
r_participantId[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]        0.02908971
r_participantId[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]        0.02368357
r_participantId[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]        0.03541931
r_participantId[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]        0.02617980
r_participantId[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]        0.02211705
r_participantId[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]        0.02975726
r_participantId[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]        0.02358295
r_participantId[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]        0.02462027
r_participantId__sigma[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept] 0.17442426
r_participantId__sigma[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept] 0.16041242
r_participantId__sigma[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept] 0.15926751
r_participantId__sigma[51da084f-6438-4f40-9569-443698b4437e,Intercept] 0.15961011
r_participantId__sigma[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept] 0.18987217
r_participantId__sigma[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept] 0.16696304
r_participantId__sigma[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept] 0.17577617
r_participantId__sigma[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept] 0.19259053
r_participantId__sigma[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept] 0.16732139
r_participantId__sigma[9f6c940d-bb71-406e-872e-2873b533048f,Intercept] 0.18660176
r_participantId__sigma[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept] 0.16685333
r_participantId__sigma[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept] 0.17160813
r_participantId__sigma[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept] 0.16618131
lprior                                                                 0.18728828
lp__                                                                   4.92432799
                                                                                Q2.5
b_Intercept                                                            -2.049553e-02
b_sigma_Intercept                                                      -1.986095e+00
sd_participantId__Intercept                                             9.690583e-04
sd_participantId__sigma_Intercept                                       7.766620e-03
Intercept                                                              -2.049553e-02
Intercept_sigma                                                        -1.986095e+00
r_participantId[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]        -6.392484e-02
r_participantId[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]        -7.447020e-02
r_participantId[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]        -4.133966e-02
r_participantId[51da084f-6438-4f40-9569-443698b4437e,Intercept]        -7.467721e-02
r_participantId[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]        -1.037661e-01
r_participantId[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]        -2.262131e-02
r_participantId[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]        -5.769097e-02
r_participantId[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]        -2.979136e-02
r_participantId[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]        -7.700082e-02
r_participantId[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]        -5.177527e-02
r_participantId[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]        -3.098344e-02
r_participantId[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]        -5.323485e-02
r_participantId[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]        -3.827324e-02
r_participantId__sigma[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept] -4.978825e-01
r_participantId__sigma[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept] -3.948549e-01
r_participantId__sigma[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept] -3.600984e-01
r_participantId__sigma[51da084f-6438-4f40-9569-443698b4437e,Intercept] -2.659987e-01
r_participantId__sigma[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept] -1.133330e-01
r_participantId__sigma[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept] -4.247173e-01
r_participantId__sigma[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept] -5.000682e-01
r_participantId__sigma[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept] -1.082147e-01
r_participantId__sigma[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept] -4.224916e-01
r_participantId__sigma[9f6c940d-bb71-406e-872e-2873b533048f,Intercept] -5.444046e-01
r_participantId__sigma[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept] -1.803684e-01
r_participantId__sigma[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept] -4.626893e-01
r_participantId__sigma[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept] -4.295147e-01
lprior                                                                 -9.223776e-01
lp__                                                                   -3.928340e+01
                                                                              Q97.5
b_Intercept                                                              0.04254726
b_sigma_Intercept                                                       -1.57704658
sd_participantId__Intercept                                              0.07567027
sd_participantId__sigma_Intercept                                        0.43827459
Intercept                                                                0.04254726
Intercept_sigma                                                         -1.57704658
r_participantId[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]          0.04215636
r_participantId[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]          0.04189500
r_participantId[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]          0.06519823
r_participantId[51da084f-6438-4f40-9569-443698b4437e,Intercept]          0.02594474
r_participantId[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]          0.02214868
r_participantId[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]          0.09103543
r_participantId[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]          0.04402728
r_participantId[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]          0.10970254
r_participantId[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]          0.03407326
r_participantId[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]          0.04329850
r_participantId[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]          0.08962385
r_participantId[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]          0.04768726
r_participantId[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]          0.06607717
r_participantId__sigma[0c671e0c-0be6-4ae5-a78e-638e59d43ddd,Intercept]   0.23232926
r_participantId__sigma[1a39e480-57b1-4bb6-ad31-cf90236fb047,Intercept]   0.29551264
r_participantId__sigma[214a00cf-a6e2-4c25-866c-804ac4c704f2,Intercept]   0.32004118
r_participantId__sigma[51da084f-6438-4f40-9569-443698b4437e,Intercept]   0.41606495
r_participantId__sigma[5f37a06e-50e4-4489-948f-c4f25bd38d17,Intercept]   0.60346277
r_participantId__sigma[758f389c-6a06-4378-9b37-dc4b0a0b3a7d,Intercept]   0.29436317
r_participantId__sigma[7856a1bc-7bae-436a-a91f-a94e3d3f5683,Intercept]   0.23305067
r_participantId__sigma[85349f2b-c75a-46ff-8f80-fafc92da11a7,Intercept]   0.61280798
r_participantId__sigma[9cadaa1e-bea2-420a-b671-eebf5b7aadfc,Intercept]   0.29544471
r_participantId__sigma[9f6c940d-bb71-406e-872e-2873b533048f,Intercept]   0.21573820
r_participantId__sigma[c87f9143-d9e8-4f50-afca-03a0839951fb,Intercept]   0.50338169
r_participantId__sigma[dc2d1f07-3b58-4484-a4b1-3f8308154717,Intercept]   0.25820097
r_participantId__sigma[f71b9ae5-1fc2-460f-879e-2984ea8df811,Intercept]   0.26543509
lprior                                                                  -0.20912267
lp__                                                                   -20.22060916</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s compare this to, e.g., the model where we’re assuming that everythign is fixed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get_variables(m1.1)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract posterior sampels </span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> m1<span class="fl">.1</span> <span class="sc">%&gt;%</span> <span class="fu">spread_draws</span>(b_Intercept, sd_participantId__Intercept, r_participantId[PID, term], </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                      b_sigma_Intercept, sd_participantId__sigma_Intercept, r_participantId__sigma[PID, term]) <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"Intercept"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_global =</span> <span class="fu">exp</span>(b_sigma_Intercept), </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">participant_mean =</span> b_Intercept <span class="sc">+</span> r_participantId, </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma_participant =</span> <span class="fu">exp</span>(b_sigma_Intercept <span class="sc">+</span> r_participantId__sigma)) </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>posterior <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> PID)) <span class="sc">+</span> </span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">x =</span> participant_mean), <span class="at">.width =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.95</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> PID)) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma_participant))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Define custom functions for posterior predictive check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a random number generator for Laplace distribution</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>laplace_rng <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate from Laplace distribution using uniform transformation</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="fu">length</span>(mu)) <span class="sc">-</span> <span class="fl">0.5</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">+</span> sigma <span class="sc">*</span> <span class="fu">sign</span>(u) <span class="sc">*</span> (<span class="sc">-</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">abs</span>(u)))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the posterior predict function for our custom family</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>posterior_predict_laplace <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">"mu"</span>, <span class="at">i =</span> i)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">"sigma"</span>, <span class="at">i =</span> i)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">laplace_rng</span>(mu, sigma)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1<span class="fl">.1</span>, <span class="at">ndraws =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>This posterior predictive check is reminding me that it could also be drawn from a Cauchy …</li>
</ul>
</section>
<section id="model-2.3-cauchy" class="level3">
<h3 class="anchored" data-anchor-id="model-2.3-cauchy">Model 2.3 — Cauchy</h3>
<p>Note that a cauchy distribution is a student t distribution with degrees of freedom, <code>nu</code>, fixed to be 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">bf</span>(error_va <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId),</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>        sigma <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId), </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="fu">student</span>())</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get prior</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.select.x <span class="sc">-</span> va.ans.x) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">formula =</span> f,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["prior"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["coef"],"name":[3],"type":["chr"],"align":["left"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]},{"label":["resp"],"name":[5],"type":["chr"],"align":["left"]},{"label":["dpar"],"name":[6],"type":["chr"],"align":["left"]},{"label":["nlpar"],"name":[7],"type":["chr"],"align":["left"]},{"label":["lb"],"name":[8],"type":["chr"],"align":["left"]},{"label":["ub"],"name":[9],"type":["chr"],"align":["left"]},{"label":["source"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"gamma(2, 0.1)","2":"nu","3":"","4":"","5":"","6":"","7":"","8":"1","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"sigma","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># constant prior for nu to make it cauchy </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">constant</span>(<span class="dv">1</span>), <span class="at">class =</span> <span class="st">"nu"</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fit the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>m1<span class="fl">.3</span> <span class="ot">&lt;-</span> task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.ans.x <span class="sc">-</span> va.select.x) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> f, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> p, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ., </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cores = 4, </span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># control = list(adapt_delta = 0.95), </span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">"models/task2-m1.3"</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Check the fitted results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: student 
  Links: mu = identity; sigma = log; nu = identity 
Formula: error_va ~ 1 + (1 | participantId) 
         sigma ~ 1 + (1 | participantId)
   Data: . (Number of observations: 130) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~participantId (Number of levels: 13) 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)           0.03      0.02     0.00     0.07 1.00     1081     1424
sd(sigma_Intercept)     0.18      0.15     0.00     0.53 1.00     1540     1258

Regression Coefficients:
                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept           0.01      0.01    -0.02     0.04 1.00     2507     2254
sigma_Intercept    -2.45      0.15    -2.74    -2.15 1.00     3090     2659

Further Distributional Parameters:
   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
nu     1.00      0.00     1.00     1.00   NA       NA       NA

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1<span class="fl">.3</span>, <span class="at">ndraws =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-2.2-normal" class="level3">
<h3 class="anchored" data-anchor-id="model-2.2-normal">Model 2.2 — Normal</h3>
<p>Math model:</p>
<p><span class="math display">\[
\begin{align}
\text{error_va}_{i} &amp;\sim \text{Normal}(\mu_{\text{PID}[i]}, \sigma_{\text{PID}[i]}) \\
\mu_j &amp;\sim \mathcal{N}(0, 0.25), j \in [13] \\
\sigma_j &amp;\sim \mathcal{N}(0, 1), j \in [13]
\end{align}
\]</span></p>
<p>The corresponding <code>brms</code> formula would be as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">bf</span>(error_va <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>         sigma <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> participantId),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get prior</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.select.x <span class="sc">-</span> va.ans.x) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">formula =</span> f2,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["prior"],"name":[1],"type":["chr"],"align":["left"]},{"label":["class"],"name":[2],"type":["chr"],"align":["left"]},{"label":["coef"],"name":[3],"type":["chr"],"align":["left"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]},{"label":["resp"],"name":[5],"type":["chr"],"align":["left"]},{"label":["dpar"],"name":[6],"type":["chr"],"align":["left"]},{"label":["nlpar"],"name":[7],"type":["chr"],"align":["left"]},{"label":["lb"],"name":[8],"type":["chr"],"align":["left"]},{"label":["ub"],"name":[9],"type":["chr"],"align":["left"]},{"label":["source"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"Intercept","3":"","4":"","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"student_t(3, 0, 2.5)","2":"sd","3":"","4":"","5":"","6":"sigma","7":"","8":"0","9":"","10":"default"},{"1":"","2":"sd","3":"","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"},{"1":"","2":"sd","3":"Intercept","4":"participantId","5":"","6":"sigma","7":"","8":"","9":"","10":"default"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define prior </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">dpar=</span><span class="st">"mu"</span>), </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> <span class="st">"Intercept"</span>, <span class="at">dpar=</span><span class="st">"sigma"</span>), </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">group =</span> <span class="st">"participantId"</span>, <span class="at">dpar=</span><span class="st">"mu"</span>, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">cauchy</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> <span class="st">"sd"</span>, <span class="at">group =</span> <span class="st">"participantId"</span>, <span class="at">dpar=</span><span class="st">"sigma"</span>, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s fit the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>m1<span class="fl">.2</span> <span class="ot">&lt;-</span> task2_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">error_va =</span> va.ans.x <span class="sc">-</span> va.select.x) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> f2,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> .,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">prior =</span> p,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># control = list(adapt_delta = 0.95), # note this is higher than 0.95</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># iter = 8000, # more iterations</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># warmup = 2000, # higher than usual</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">file=</span><span class="st">"models/task2-m1.2"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">save_pars =</span> <span class="fu">save_pars</span>(<span class="at">all=</span><span class="cn">TRUE</span>)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see some fitted results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = log 
Formula: error_va ~ 1 + (1 | participantId) 
         sigma ~ 1 + (1 | participantId)
   Data: . (Number of observations: 130) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Multilevel Hyperparameters:
~participantId (Number of levels: 13) 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)           0.07      0.04     0.00     0.16 1.00      828     1348
sd(sigma_Intercept)     0.24      0.11     0.02     0.49 1.00      691      472

Regression Coefficients:
                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept           0.01      0.03    -0.05     0.08 1.00     1847     2070
sigma_Intercept    -1.41      0.10    -1.60    -1.21 1.00     2282     2443

Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior predictive check</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pp_check</span>(m1<span class="fl">.2</span>, <span class="at">ndraws =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="models-task2_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The fit doesn’t look that good lol.</p>
</section>
<section id="loo-comparisons" class="level3">
<h3 class="anchored" data-anchor-id="loo-comparisons">LOO comparisons</h3>
<p>We can also perform loo comparison between <code>m1.1</code> and <code>m1.2</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(m1<span class="fl">.1</span>, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Trying to compile a simple C file</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Running /Library/Frameworks/R.framework/Resources/bin/R CMD SHLIB foo.c
using C compiler: ‘Apple clang version 16.0.0 (clang-1600.0.26.6)’
using SDK: ‘’
clang -arch arm64 -I"/Library/Frameworks/R.framework/Resources/include" -DNDEBUG   -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/Rcpp/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/unsupported"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/BH/include" -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/src/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppParallel/include/"  -I"/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/rstan/include" -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include '/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp'  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1   -I/opt/R/arm64/include    -fPIC  -falign-functions=64 -Wall -g -O2  -c foo.c -o foo.o
In file included from &lt;built-in&gt;:1:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp:22:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/Dense:1:
In file included from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/Core:19:
/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/Eigen/src/Core/util/Macros.h:679:10: fatal error: 'cmath' file not found
  679 | #include &lt;cmath&gt;
      |          ^~~~~~~
1 error generated.
make: *** [foo.o] Error 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define log-likelihood function for Laplace distribution</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>laplace_lpdf <span class="ot">&lt;-</span> <span class="cf">function</span>(y, mu, sigma) {</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> sigma) <span class="sc">-</span> <span class="fu">abs</span>(y <span class="sc">-</span> mu) <span class="sc">/</span> sigma</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define log-likelihood function for brms</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>log_lik_laplace <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">"mu"</span>, <span class="at">i =</span> i)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">get_dpar</span>(prep, <span class="st">"sigma"</span>, <span class="at">i =</span> i)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">laplace_lpdf</span>(y, mu, sigma)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alright let’s do the actual comparison:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(m1<span class="fl">.1</span>, m1<span class="fl">.2</span>, m1<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 1 observations with a pareto_k &gt; 0.7 in model 'm1.1'. We
recommend to set 'moment_match = TRUE' in order to perform moment matching for
problematic observations.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Found 3 observations with a pareto_k &gt; 0.7 in model 'm1.2'. We
recommend to set 'moment_match = TRUE' in order to perform moment matching for
problematic observations.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Output of model 'm1.1':

Computed from 4000 by 130 log-likelihood matrix.

         Estimate   SE
elpd_loo      8.8 13.7
p_loo         9.2  1.1
looic       -17.6 27.4
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.2]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     129   99.2%   896     
   (0.7, 1]   (bad)        1    0.8%   &lt;NA&gt;    
   (1, Inf)   (very bad)   0    0.0%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Output of model 'm1.2':

Computed from 4000 by 130 log-likelihood matrix.

         Estimate   SE
elpd_loo    -12.5 13.4
p_loo        20.2  4.2
looic        25.0 26.8
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.3, 1.4]).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     127   97.7%   82      
   (0.7, 1]   (bad)        2    1.5%   &lt;NA&gt;    
   (1, Inf)   (very bad)   1    0.8%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.

Output of model 'm1.3':

Computed from 4000 by 130 log-likelihood matrix.

         Estimate   SE
elpd_loo      7.1 14.6
p_loo         9.4  0.2
looic       -14.1 29.2
------
MCSE of elpd_loo is 0.1.
MCSE and ESS estimates assume MCMC draws (r_eff in [0.5, 1.3]).

All Pareto k estimates are good (k &lt; 0.7).
See help('pareto-k-diagnostic') for details.

Model comparisons:
     elpd_diff se_diff
m1.1   0.0       0.0  
m1.3  -1.7       3.4  
m1.2 -21.3       4.6  </code></pre>
</div>
</div>
<p>From the <code>pp_check</code>s and the loo comparison it is clear that the Laplace distribution (aka Double Exponential) distribution fits the model better.</p>
<!-- Hmm the half-normal model doesn't look quite right, perhaps this follows closer to an exponential distribution? Also we need to take care of teh number of times thigns were zero, so this should be a **zero-inflated exponential model**. Something like the following:  -->
<!-- $$ -->
<!-- \begin{align} -->
<!-- \text{error}_{\text{va}}[i] &\sim \text{Exponential}(\lambda_{\text{PID}[i]}) \\  -->
<!-- \lambda &= \exp(\alpha + u_j) \\  -->
<!-- \alpha &\sim \mathcal{N}(0, 1) \\  -->
<!-- u_j &\sim \mathcal{N}(0, \sigma_u^2) \\  -->
<!-- \sigma_u &\sim \text{Half-Cauchy}(0, 5)  -->
<!-- \end{align} -->
<!-- $$ -->
<!-- :::{.caution} -->
<!-- While doing the fitting I found some issues ... For task 2, `error_va = va.ans.y - va.select.y` should always be non-negative, but I got some negative values that are very, very small. I am setting a tolerance of `1e-12` --- any value smaller than this range will be regarded as 0. See the following for the negative values  -->
<!-- ```{r} -->
<!-- task2_df %>% mutate(error_va = va.ans.y - va.select.y) %>% filter(error_va < 0) %>%  -->
<!--   select(data.select.y, data.ans.y) %>%  -->
<!--   mutate(diff = data.select.y - data.ans.y) %>%  -->
<!--   pull(diff) -->
<!-- ``` -->
<!-- ::: -->
<!-- Fit the model:  -->
<!-- ```{r} -->
<!-- #| output: false -->
<!-- #| label: task2-fit-model -->
<!-- m2.1 <- task2_df %>% mutate(error_va = va.ans.y - va.select.y) %>%  -->
<!--   mutate(error_va = ifelse(abs(error_va) < 1e-8, 0, error_va)) %>%  -->
<!--   brm(formula = f, -->
<!--       data = .,  -->
<!--       prior = p, -->
<!--       control = list(adapt_delta = 0.99), # note this is higher than 0.95 -->
<!--       chains = 4,  -->
<!--       iter = 8000, # more iterations -->
<!--       warmup = 2000, # higher than usual  -->
<!--       file="models/m2.1",  -->
<!--       save_pars = save_pars(all=TRUE) -->
<!--       ) -->
<!-- ``` -->
<!-- ## Model 2 -- Physical -->
<!-- Math model:  -->
<!-- $$ -->
<!-- \begin{aligned} -->
<!-- \text{error}_{\text{phy}}[i] &\sim \text{Half-Normal}(\sigma[i]) \\  -->
<!-- \sigma[i] &= \texttt{dist_to_screen} \times \hat{\sigma}[i]\\  -->
<!-- \hat{\sigma}[i] &\sim \text{Log-Normal}(0, 1) -->
<!-- \end{aligned} -->
<!-- $$ -->
<!-- Formula:  -->
<!-- ```{r} -->
<!-- f <- bf(error_phy | trunc(lb = 0) ~ 0,  -->
<!--         sigma ~ 0 + offset(log(dist_to_screen)) + (1 | participantId),  -->
<!--         family = gaussian()) -->
<!-- p <- prior(lognormal(0, 1), class = "sd", dpar="sigma", group="participantId") -->
<!-- ``` -->
<!-- Fit model:  -->
<!-- ```{r} -->
<!-- #| output: false  -->
<!-- m2.2 <- task2_df %>%  -->
<!--   mutate(error_phy = phy.ans.y - phy.select.y) %>%  -->
<!--   # note that the usual tolerance of 1e-12 is not good enough  -->
<!--   # mutate(error_phy = ifelse(abs(error_phy) < 1e-8, 0, error_phy)) %>%  -->
<!--   # let's just make everything negative to be 0  -->
<!--   mutate(error_phy = ifelse(error_phy < 0, 0, error_phy)) %>%  -->
<!--   brm(formula = f, -->
<!--       data = .,  -->
<!--       prior = p, -->
<!--       control = list(adapt_delta = 0.99), # note this is higher than 0.95 -->
<!--       chains = 4,  -->
<!--       iter = 8000, # more iterations -->
<!--       warmup = 2000, # higher than usual  -->
<!--       file="models/m2.2",  -->
<!--       save_pars = save_pars(all=TRUE) -->
<!--       ) -->
<!-- ``` -->
<!-- Check fit:  -->
<!-- ```{r} -->
<!-- summary(m2.2) -->
<!-- plot(m2.2) -->
<!-- pp_check(m2.2, ndraws = 100) -->
<!-- ``` -->
<!-- ## Compare model 1 and model 2  -->
<!-- ```{r} -->
<!-- m2.1 <- add_criterion(m2.1, "loo", moment_match=TRUE, recompile=TRUE) -->
<!-- m2.2 <- add_criterion(m2.2, "loo", moment_match = TRUE, recompile=TRUE) -->
<!-- loo_compare(m2.1, m2.2) -->
<!-- ``` -->
<!-- The visual angle version is also better.  -->
<!-- --- -->
<!-- Then we check to make sure that things are correct:  -->
<!-- ```{r} -->
<!-- #| output: false  -->
<!-- #| code-fold: true  -->
<!-- #| label: task 2 verify  -->
<!-- task2_df %>% ggplot(aes(x = data.select.x - data.ans.x)) +  -->
<!--   geom_dots() -->
<!-- task2_df %>% ggplot(aes(x = data.select.y - data.ans.y)) +  -->
<!--   geom_dots() -->
<!-- task2_df %>% ggplot(aes(x = pixel.select.x - pixel.ans.x)) +  -->
<!--   geom_dots() -->
<!-- task2_df %>% ggplot(aes(x = pixel.select.y - pixel.ans.y)) +  -->
<!--   geom_dots() -->
<!-- task2_df %>% ggplot(aes(x = phy.select.x - phy.ans.x)) +  -->
<!--   geom_dots()   -->
<!-- task2_df %>% ggplot(aes(x = phy.select.y - phy.ans.y)) +  -->
<!--   geom_dots()  -->
<!-- task2_df %>% ggplot(aes(x = va.select.x - va.ans.x)) +  -->
<!--   geom_dots()   -->
<!-- task2_df %>% ggplot(aes(x = va.select.y - va.ans.y)) +  -->
<!--   geom_dots()   -->
<!-- ``` -->
<!-- Note that `grad.x` is calcultaing the angle of the slope^[i.e. gradient] at selection `x`. It is NOT the perceived angle.  -->
<!-- Let's plot the relation between the angle selected and the parameters:  -->
<!-- ```{r} -->
<!-- #| code-fold: true  -->
<!-- #| layout-ncol: 2 -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = param.p)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = param.q)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = param.lambda)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = param.mu)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = param.sigma)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- task2_df %>% ggplot(aes(y = data.select.grad, x = dist_to_screen)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- ``` -->
<!-- The only thing that is worth noting is the relationship between `data.select.grad` and `dist_to_screen`. What about the corresponding angle?  -->
<!-- ```{r} -->
<!-- task2_df %>% ggplot(aes(y = data.select.angle, x = dist_to_screen)) + -->
<!--   geom_point(alpha = 0.5) -->
<!-- ``` -->
<!-- --- -->
<!-- How to calculate the actual angle, based on the selection? First we can check out the distribution of calculated angle (relative to the highest point?) -->
<!-- ```{r} -->
<!-- task2_df %>%  -->
<!--   mutate(diff.x = phy.select.x - phy.ans.x,  -->
<!--          diff.y = phy.select.y - phy.ans.y,  -->
<!--          angle = atan(diff.y / diff.x) * 180 / pi) %>%  -->
<!--   ggplot(aes(x = angle)) +  -->
<!--   geom_dots() -->
<!-- ``` -->
<!-- We are seeing these extreme outliers because `diff.x` is very, very small, almost close to 0. The above calculations does not deal well with very, very small denominators. Doing things in the visual angle space gives the same outliers. Let's just round things up to 3:  -->
<!-- ```{r} -->
<!-- task2_df %>% mutate(diff.x = phy.select.x - phy.ans.x,  -->
<!--                     diff.y = phy.select.y - phy.ans.y) %>%  -->
<!--   mutate(diff.x = round(diff.x, 3), diff.y = round(diff.y, 3)) %>%  -->
<!--   mutate(angle = case_when(diff.x == 0 ~ 0,  -->
<!--                            diff.x != 0 ~ atan(diff.y / diff.x) * 180 / pi )) %>%  -->
<!--   ggplot(aes(x = angle)) +  -->
<!--   geom_dots() -->
<!-- task2_df %>% mutate(diff.x = phy.select.x - phy.ans.x,  -->
<!--                     diff.y = phy.select.y - phy.ans.y) %>%  -->
<!--   mutate(diff.x = round(diff.x, 3), diff.y = round(diff.y, 3)) %>%  -->
<!--   mutate(angle = case_when(diff.x == 0 ~ 0,  -->
<!--                            diff.x != 0 ~ atan(diff.y / diff.x) * 180 / pi )) %>%  -->
<!--   ggplot(aes(x = angle, y = data.select.angle)) +  -->
<!--   geom_point(alpha = 0.5) +  -->
<!--   geom_abline(intercept = 0, slope = 1, color = "black", linetype = "dashed") -->
<!-- ``` -->
<!-- This just means that if we were to use the highest point and the selected point as ways to calculate the actual angle, then it is **larger** than the actual slope at the selected point.  -->
<!-- Is this newly calculated `angle` going to be related to `dist_to_screen`?  -->
<!-- ```{r} -->
<!-- task2_df %>% mutate(diff.x = phy.select.x - phy.ans.x,  -->
<!--                     diff.y = phy.select.y - phy.ans.y) %>%  -->
<!--   mutate(diff.x = round(diff.x, 3), diff.y = round(diff.y, 3)) %>%  -->
<!--   mutate(angle = case_when(diff.x == 0 ~ 0,  -->
<!--                            diff.x != 0 ~ atan(diff.y / diff.x) * 180 / pi )) %>%  -->
<!--   ggplot(aes(x = dist_to_screen, y = angle)) +  -->
<!--   geom_point(alpha = 0.5) -->
<!-- ``` -->
<!-- Compare to the graph before, the difference is that this one has a bigger variance.  -->
<!-- What if we use the numbers in the visual angle space and not the physical space?  -->
<!-- ```{r} -->
<!-- task2_df %>% mutate(diff.x = va.select.x - va.ans.x,  -->
<!--                     diff.y = va.select.y - va.ans.y) %>%  -->
<!--   mutate(diff.x = round(diff.x, 3), diff.y = round(diff.y, 3)) %>%  -->
<!--   mutate(angle = case_when(diff.x == 0 ~ 0,  -->
<!--                            diff.x != 0 ~ atan(diff.y / diff.x) * 180 / pi )) %>%  -->
<!--   ggplot(aes(x = dist_to_screen, y = angle)) +  -->
<!--   geom_point(alpha = 0.5) -->
<!-- ``` -->
<!-- Hmm doesn't seem to be much different, which is to be expected, as slope is unit-less.  -->
<!-- ---  -->
</section>
</section>
</section>


</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>