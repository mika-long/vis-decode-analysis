---
title: "analysis"
format:
  html: 
    code-fold: true
---

```{r}
#| echo: false
#| output: false

library(tidyverse)
library(ggplot2)
library(sgt)
library(numDeriv)
```

Let first read in the file. 

```{r}
df <- read.csv("vis-decode-slider_all_tidy.csv") %>% as_tibble(.)
```

Let us just do some very simple pruning through the data: 

```{r}
df %>% count(participantId)
```

Though where `n < 492` are those that didn't finish the full set of things. Right now we have 10 trials --- 1 done by Maryam, 1 done by Lily, 8 done by me. Those done by Maryam and Lily had some issue with the tangent line (the guideline didn't show up correctly) but they did their best for interpretation. Let's pull out these ids

```{r}
df %>% count(participantId) %>% filter(n == 492) %>% pull(participantId) -> ids
ids
```
```{r}
df %>% filter(participantId %in% ids) %>% 
    filter(grepl("task", trialId) & grepl("test", trialId) ) %>% 
    select(participantId, trialId, responseId, answer) %>% 
    mutate(answer = as.numeric(answer)) %>% 
    pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") -> task_df # %>% 
    # separate_wider_delim(trialId, delim="_", names = c("TaskType", "type", "id")) %>% 
    # select(-type, -pixel.x, -pixel.y) -> task_df

task_df
```

# Task 1 --- PDF Median --- split area into equal halves 

```{r}
task_df %>% filter(grepl("task1", trialId)) %>% 
  mutate(left_area = psgt(location.x, param.mu, param.sigma, 
                          param.lambda, param.p, param.q)) 
```

Let's see if there's any relation between `lambda` and `area`: 

```{r}
task_df %>% filter(grepl("task1", trialId)) %>% 
  mutate(left_area = psgt(location.x, param.mu, param.sigma, 
                          param.lambda, param.p, param.q, mean.cent=F)) %>% 
  select(param.lambda, left_area) %>% 
  ggplot(aes(x = param.lambda, y = left_area)) + 
  geom_point(alpha = 0.5) + 
  theme_minimal() + xlim(-1, 1) + ylim(0, 1) + 
  geom_hline(yintercept = 0.5, linetype="dashed", color="gray")
```

Note that `lambda = 0` is complete symmetry ($\lambda \in (-1, 1)$). We see a definite trend here! 

## Task 2 --- PDF Mode --- Find highest point on the curve 

TODO --- this is where we use `numDeriv` !!! 

```{r}
task_df %>% filter(grepl("task2", trialId)) %>%
  mutate(answer.x = param.mu, 
         answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma, 
                         lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>% 
  select(participantId, location.x, location.y, answer.x, answer.y)
```

Let's try to plot the distribution of error, first for `x`: 

```{r}
#| layout-ncol: 2

task_df %>% filter(grepl("task2", trialId)) %>%
  mutate(answer.x = param.mu, 
         answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma, 
                         lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>% 
  select(participantId, location.x, location.y, answer.x, answer.y) %>% 
  mutate(x_diff = location.x - answer.x) %>% 
  ggplot(aes(x = x_diff)) + geom_density() + theme_minimal()

task_df %>% filter(grepl("task2", trialId)) %>%
  mutate(answer.x = param.mu, 
         answer.y = dsgt(x=param.mu, mu = param.mu, sigma=param.sigma, 
                         lambda=param.lambda, p=param.p, q=param.q, mean.cent = F)) %>% 
  select(participantId, location.x, location.y, answer.x, answer.y) %>% 
  mutate(y_diff = location.y - answer.y) %>% 
  ggplot(aes(x = y_diff)) + geom_density() + theme_minimal()
```

TODO: `numderiv` and angle calculations ... 

## Task 3 --- CDF Median --- find point where `y == 0.5`

Doesn't seem to be any particularly standing out ... 

```{r}
task_df %>% filter(grepl("task3", trialId)) %>% 
  ggplot(aes(x = location.x, y = location.y)) + 
  geom_point() + 
  theme_minimal() + 
  geom_hline(yintercept = 0.5, linetype="dashed", color="gray") # + 
  # facet_wrap(~ participantId)
```

---

Task 4 --- CDF Mode --- Find slope

Recall that mode is just `param.mu`. 

```{r}
task_df %>% filter(grepl("task3", trialId)) %>% 
  ggplot(aes(x = location.x, y = param.mu)) + 
  geom_point(alpha=0.5) + theme_minimal() + 
  geom_abline(slope = 1, intercept = 0, linetype="dashed", color="gray") + 
  coord_equal()
```

--- 

Task 5 --- Project from dot to axes

```{r}
df %>% filter(grepl("task5", trialId)) %>% 
  filter(grepl("test", trialId)) %>%
  select(participantId, trialId, responseId, answer) %>% 
  mutate(answer = as.numeric(answer)) %>% 
  pivot_wider(names_from = responseId, values_from = answer, names_repair = "universal") %>% 
  separate_wider_delim(trialId, delim="_", names = c("TaskType", "type", "id")) %>% 
  select(-type) -> task_5

task_5
```

How accurate where the xs? 

```{r}
task_5 %>% 
  ggplot(aes(x = slider.x, y = location.x)) + 
  geom_point(alpha=0.5) + 
  theme_minimal() + 
  geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed") + 
  coord_equal()
```

How accurate where the ys? 

```{r}
task_5 %>% 
  ggplot(aes(x = slider.y, y = location.y)) + 
  geom_point(alpha=0.5) + 
  theme_minimal() + 
  geom_abline(intercept = 0, slope = 1, color = "gray", linetype = "dashed") + 
  coord_equal()
```



<!-- ---  -->

<!-- ```{r} -->
<!-- task_df %>% mutate(median.x = case_when(TaskType == "task1" | TaskType == "task2" ~ qsgt(0.5, mu = param.mu, lambda = param.lambda,  -->
<!--                                                                                       sigma = param.sigma, p = param.p, q = param.q),  -->
<!--                                      .default = qsgt(0.5, mu = param.mu, lambda = param.lambda,  -->
<!--                                                      sigma = param.sigma, p = param.p, q = param.q)),  -->
<!--                 median.y = case_when(TaskType == "task1" | TaskType == "task2" ~ dsgt(median.x, mu = param.mu, lambda = param.lambda,  -->
<!--                                                                                       sigma = param.sigma, p = param.p, q = param.q),  -->
<!--                                      .default = 0.5),  -->
<!--                 mode.x = case_when(TaskType == "task1" | TaskType == "task2" ~ param.mu,  -->
<!--                                    .default = param.mu),  -->
<!--                 mode.y = case_when(TaskType == "task1" | TaskType == "task2" ~ dsgt(mode.x, mu = param.mu, lambda = param.lambda,  -->
<!--                                                                                     sigma = param.sigma, p = param.p, q = param.q),  -->
<!--                                    .default = psgt(mode.x, mu = param.mu, lambda = param.lambda,  -->
<!--                                                    sigma = param.sigma, p = param.p, q = param.q))) %>%  -->
<!--   select(TaskType, id, location.x, location.y, median.x, median.y, mode.x, mode.y) -->
<!-- ``` -->

